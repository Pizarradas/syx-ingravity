// CORE
// ===============================================
@use 'sass:map';
@use '../abstracts/index' as *;
// ===============================================

// ORG: header (unified â all themes)
// ===============================================
// Mixin: org-header($theme)
// Supported themes: syx | codymer | coral | forest | midnight
//
// ââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
// â  HOW THEME VARIATION WORKS â 3 methods               â
// â                                                      â
// â  METHOD 1 Â· CSS Custom Properties (var)              â
// â  â Values that differ per theme but all themes       â
// â    have one. Define the generic token here,          â
// â    each _theme.scss overrides the value.             â
// â    USE FOR: colors, spacing, icons, shadows.         â
// â                                                      â
// â  METHOD 2 Â· Sass Map / theme-cfg()                   â
// â  â Compile-time Sass values stored in               â
// â    abstracts/_theme-config.scss. Resolved at         â
// â    build time, not at runtime.                       â
// â    USE FOR: structural layout (left/right),          â
// â    Sass-only sizes, boolean flags.                   â
// â                                                      â
// â  METHOD 3 Â· @if $theme                               â
// â  â Direct style override for 1â2 themes only.        â
// â    No token, no map needed.                          â
// â    USE FOR: one-off rules that only one theme        â
// â    needs and would pollute the token layer.          â
// â                                                      â
// â  RULE: if ALL themes need a value â Method 1         â
// â        if a value is reused in multiple spots â M2   â
// â        if only 1-2 themes need it â Method 3         â
// ââââââââââââââââââââââââââââââââââââââââââââââââââââââââ
// ===============================================

@mixin org-header($theme: null) {
  @layer syx.organisms {
  .org-header {

    // âââ BASE â common to ALL themes âââââââââââââââââââââââââââââ
    @include position(sticky, 0, null, null, null);
    @include padding(var(--component-header-padding-y) null);
    z-index: var(--component-header-z-index);

    // âââ METHOD 1 Â· CSS Custom Property ââââââââââââââââââââââââââ
    // All themes have a background color but each one differs.
    // The token --component-header-bg is defined generically here;
    // each theme's _theme.scss overrides it with its own value.
    // Default fallback in abstracts/tokens/components/_headers.scss â transparent.
    background-color: var(--component-header-bg);

    // âââ METHOD 3 Â· @if â border-bottom only for codymer âââââââââ
    // This border-bottom is exclusive to Codymer. Adding a token for it
    // just to serve one theme would pollute the token layer unnecessarily.
    @if $theme == 'codymer' {
      border-bottom: 1px solid var(--component-header-border-color, var(--semantic-color-border-subtle));
    }

    // âââ METHOD 3 Â· @if â backdrop blur only for midnight ââââââââ
    // Midnight is a dark glass-morphism theme; blur makes sense only there.
    @if $theme == 'midnight' {
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    // &__sidenav ââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__sidenav {
      // BASE
      @include size(var(--component-sidenav-width), 100%);
      z-index: var(--component-sidenav-z-index);
      overflow-x: hidden;
      @include transition(transform 0.5s ease);

      // METHOD 1 Â· tokens
      background-color: var(--component-sidenav-bg);
      box-shadow: var(--component-sidenav-shadow);

      // âââ METHOD 2 Â· Sass Map â sidenav side ââââââââââââââââââââ
      // Codymer's sidenav opens from the right (brand identity).
      // The value lives in $theme-config so any future mixin that
      // needs to know which side can also call theme-cfg().
      @if theme-cfg($theme, 'header-sidenav-side', left) == right {
        @include position(fixed, 0, 0, null, null);
        transform: translateX(100%);
      } @else {
        @include position(fixed, 0, null, null, 0);
        transform: translateX(-100%);
      }

      &.is-open {
        transform: translateX(0);
      }
    }

    // &__header âââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__header {
      min-height: var(--component-header-height);
      flex-basis: 100%;
    }

    // &__content ââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__content {
      @include padding(var(--semantic-space-inset-md));
      flex-basis: 100%;
    }

    // &__footer âââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__footer {
      @include padding(var(--semantic-space-inset-md));
      flex-basis: 100%;
      align-self: flex-end;
    }

    // &__logo âââââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__logo {
      // BASE
      @include position(relative);
      @include transition(color 0.25s ease-out);

      // METHOD 1 Â· token â padding driven by theme
      @include padding(null null null var(--component-header-logo-padding-left));
      color: var(--component-header-logo-color);

      @include min-screen(768px) {
        @include padding(null null null var(--component-header-logo-padding-left-md));
      }

      // :before â logo icon
      &:before {
        content: '';
        @include position(absolute, 0, null, 0, 0);
        margin: auto 0;
        @include transition(all 0.25s ease-out);

        // âââ METHOD 1 Â· CSS token â logo SVG per theme âââââââââââ
        // Each _theme.scss defines --component-header-logo-icon
        // pointing to its own inline SVG or external asset.
        // example-02/_theme.scss â --component-header-logo-icon: var(--icon-logo-codymer)
        // example-03/_theme.scss â --component-header-logo-icon: var(--icon-logo-coral)
        @include background-setup(
          var(--component-header-logo-icon),
          '0 0 / contain',
          no-repeat
        );
        filter: var(--filter-primary);

        // âââ METHOD 2 Â· Sass Map â logo size per theme âââââââââââ
        // Size is a Sass value (not a CSS variable) because it may
        // differ at compile time and we want type safety.
        // theme-cfg() reads from abstracts/_theme-config.scss.
        // If no override â falls back to the CSS token.
        $logo-size: theme-cfg($theme, 'header-logo-size', null);
        @if $logo-size {
          width:  $logo-size;
          height: $logo-size;
        } @else {
          @include size(var(--component-header-logo-icon-size));
        }

        @include min-screen(768px) {
          $logo-size-md: theme-cfg($theme, 'header-logo-size-md', null);
          @if $logo-size-md {
            width:  $logo-size-md;
            height: $logo-size-md;
          } @else {
            @include size(var(--component-header-logo-icon-size-md));
          }
        }
      }

      &:hover        { color: var(--component-header-logo-color-hover); }
      &:focus-visible {
        outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
      }
    }

    // &__nav ââââââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__nav {
      margin-left: auto;
    }

    // &-nav (Sidenav Menu) ââââââââââââââââââââââââââââââââââââââââ
    &-nav {
      margin: 0;
      padding: 0;
      list-style: none;

      &__item {
        margin-bottom: 0.5rem;
      }

      &__link {
        @include position(relative);
        @include padding(
          var(--component-sidenav-link-padding-y)
          var(--component-sidenav-link-padding-x)
          var(--component-sidenav-link-padding-y)
          0
        );
        width: 100%;
        display: block;
        font-weight: var(--component-sidenav-link-font-weight);

        &:before {
          content: '';
          @include position(absolute, 0, 0, 0, null);
          margin: auto 0;
          @include size(var(--component-sidenav-link-arrow-size));
          @include background-setup(
            var(--icon-arrow-default),
            'center / contain',
            no-repeat
          );
          filter: var(--filter-color-white);
        }

        &:hover { text-decoration: underline; }

        &:focus-visible {
          outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
        }
      }

      &__lvl2 {
        @include margin(0.7rem null 1rem null);
        @include padding(null null null 0.5rem);
      }
    }

    // &-rrss (Social icons) âââââââââââââââââââââââââââââââââââââââ
    &-rrss {
      @include margin(var(--component-header-social-gap) null);
      padding: 0;
      gap: var(--component-header-social-gap);
      display: flex;

      .helper-icon {
        @include size(var(--component-header-social-icon-size));
        @include flex-center();

        &:before {
          @include size(calc(var(--component-header-social-icon-size) * 0.8));
          filter: var(--filter-color-white);
        }
      }

      &__link {
        @include position(relative);
        @include size(var(--component-header-social-icon-size));
        display: block;

        &:focus-visible {
          outline: var(--semantic-border-width-focus) solid var(--semantic-color-state-focus);
        }
      }
    }

    // &__close ââââââââââââââââââââââââââââââââââââââââââââââââââââ
    &__close {
      @include position(
        absolute,
        var(--semantic-space-inset-md),
        var(--semantic-space-inset-md),
        null,
        null
      );

      .atom-btn {
        &:not(:hover) {
          background-color: transparent;
          .atom-icon:before {
            filter: var(--filter-color-white);
          }
        }
      }
    }

  } // end .org-header
  } // end @layer syx.organisms
}
