// CORE
// ===============================================
@use "../abstracts/index" as *;
// ===============================================

// ORG: navbar
// Mobile-first sticky navbar with hamburger drawer.
// Desktop: inline links. Mobile: slide-in drawer.
// ===============================================
@mixin org-navbar($theme: null) {
  @layer syx.organisms {

  .org-navbar {
    @include position(sticky, 0, null, null, null);
    z-index: var(--component-header-z-index, 100);
    background: var(--semantic-color-bg-secondary);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    @include border(bottom, 1px, solid, var(--semantic-color-border-subtle));

    // &__bar â the always-visible top row
    &__bar {
      @include flex-between;
      @include padding(var(--semantic-space-component-sm) 0);
      min-height: var(--component-header-height, 3.5rem);
    }

    // &__logo
    &__logo {
      font-size: var(--primitive-fluid-font-h4);
      font-family: var(--primitive-font-family-syne-bold);
      font-weight: 800;
      color: var(--semantic-color-primary);
      letter-spacing: -0.03em;
      text-decoration: none;
      flex-shrink: 0;
      @include transition(opacity 0.2s ease);

      &:hover { opacity: 0.8; }

      &:focus-visible {
        outline: 0.2rem solid var(--semantic-color-state-focus);
        @include border-radius(var(--semantic-border-radius-sm));
      }
    }

    // &__links â desktop navigation (hidden on mobile)
    &__links {
      display: none;

      @include breakpoint(tablet) {
        @include flex(null, null, center, null, var(--semantic-space-inline-md, 1.25rem));
      }
    }

    // &__toggle â hamburger button (visible only on mobile)
    &__toggle {
      @include flex(column, center, center, null, 5px);
      @include size(2.5rem);
      @include padding(0.4rem);
      background: transparent;
      @include border(all, 0);
      @include border-radius(var(--semantic-border-radius-sm));
      cursor: pointer;
      flex-shrink: 0;
      @include transition(background-color 0.2s ease);

      @include breakpoint(tablet) {
        display: none;
      }

      span {
        display: block;
        @include size(1.25rem, 2px);
        background-color: var(--semantic-color-text-primary);
        @include border-radius(2px);
        @include transition(transform 0.3s ease, opacity 0.3s ease, width 0.3s ease);
        transform-origin: center;
      }

      &:hover {
        background-color: var(--semantic-color-bg-tertiary);
      }

      &:focus-visible {
        outline: 0.2rem solid var(--semantic-color-state-focus);
      }

      // Open state â animates to Ã (X)
      &[aria-expanded="true"] {
        span:nth-child(1) {
          transform: translateY(7px) rotate(45deg);
        }
        span:nth-child(2) {
          opacity: 0;
          width: 0;
        }
        span:nth-child(3) {
          transform: translateY(-7px) rotate(-45deg);
        }
      }
    }

    // &__mobile-menu â full-width drawer shown when toggle is open
    &__mobile-menu {
      max-height: 0;
      overflow: hidden;
      background: var(--semantic-color-bg-secondary);
      @include border(top, 1px, solid, transparent);
      @include transition(max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.2s ease);

      @include breakpoint(tablet) {
        display: none;
      }

      // Open state
      &.is-open {
        max-height: 32rem; // Enough for all links + switcher
        border-top-color: var(--semantic-color-border-subtle);
      }
    }

    // &__mobile-nav â list of links inside the drawer
    &__mobile-nav {
      @include flex(column, null, null, null, 0);
      @include padding(var(--semantic-space-component-md) 0);
    }

    // &__mobile-link â individual link in the drawer
    &__mobile-link {
      @include flex(null, null, center);
      @include padding(var(--semantic-space-component-sm) var(--semantic-space-component-md));
      font-size: var(--semantic-font-size-body);
      font-weight: var(--semantic-font-weight-medium, 500);
      color: var(--semantic-color-text-primary);
      text-decoration: none;
      @include border-radius(var(--semantic-border-radius-sm));
      @include transition(background-color 0.15s ease, color 0.15s ease);

      &:hover {
        background-color: var(--semantic-color-bg-tertiary);
        color: var(--semantic-color-primary);
      }

      &:focus-visible {
        outline: 0.2rem solid var(--semantic-color-state-focus);
      }

      // CTA variant inside mobile menu
      &--cta {
        @include margin(var(--semantic-space-component-xs) null null null);
        font-weight: var(--semantic-font-weight-bold);
        color: var(--semantic-color-primary);
      }
    }

    // &__mobile-footer â theme switcher row in mobile drawer
    &__mobile-footer {
      @include flex(null, null, center, null, var(--semantic-space-inline-sm));
      @include padding(var(--semantic-space-component-sm) var(--semantic-space-component-md) var(--semantic-space-component-md));
      @include border(top, 1px, solid, var(--semantic-color-border-subtle));
      @include margin(var(--semantic-space-component-xs) null null null);

      &__label {
        font-size: var(--semantic-font-size-body-small);
        color: var(--semantic-color-text-tertiary);
        font-weight: var(--semantic-font-weight-medium, 500);
        white-space: nowrap;
      }
    }

    // .syx-theme-switcher â container visibility controlled here
    // Standalone styles are below (outside mixin, compiled globally)
    &__theme-switcher--desktop {
      display: none;

      @include breakpoint(tablet) {
        display: flex;
      }
    }

    // &__dark-toggle â light/dark mode button
    &__dark-toggle {
      display: none;
      @include flex(null, center, center);
      @include size(2rem);
      @include padding(0);
      font-size: 1.1rem;
      line-height: 1;
      background: transparent;
      @include border(all, 1px, solid, var(--semantic-color-border-subtle));
      @include border-radius(var(--semantic-border-radius-full));
      color: var(--semantic-color-text-secondary);
      cursor: pointer;
      flex-shrink: 0;
      @include transition(background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease);

      @include breakpoint(tablet) {
        display: flex;
      }

      &:hover {
        background-color: var(--semantic-color-bg-tertiary);
        color: var(--semantic-color-text-primary);
        border-color: var(--semantic-color-border-default);
      }

      &:focus-visible {
        outline: 0.2rem solid var(--semantic-color-state-focus);
        outline-offset: 2px;
      }
    }

    // -----------------------------------------------
    // MODIFIER: --docs
    // Adds a sidebar toggle button for documentation pages.
    // The sidebar toggle appears on mobile only (hidden on desktop
    // where the sidebar is always visible in the sticky grid layout).
    // -----------------------------------------------
    &--docs {
      // Hide the main hamburger â sidebar toggle replaces it on mobile
      .org-navbar__toggle {
        display: none;
      }

      .org-navbar__sidebar-toggle {
        @include flex(column, center, center, null, 5px);
        @include size(2.5rem);
        @include padding(0.4rem);
        background: transparent;
        border: none;
        @include border-radius(var(--semantic-border-radius-sm));
        cursor: pointer;
        flex-shrink: 0;
        order: -1; // Left of logo
        @include transition(background-color 0.2s ease);

        span {
          display: block;
          @include size(1.25rem, 2px);
          background-color: var(--semantic-color-text-primary);
          @include border-radius(2px);
          @include transition(transform 0.3s ease, opacity 0.3s ease);
        }

        &:hover {
          background-color: var(--semantic-color-bg-tertiary);
        }

        &:focus-visible {
          outline: 0.2rem solid var(--semantic-color-state-focus);
        }

        @include breakpoint(tablet) {
          display: none; // Hidden on desktop â sidebar is always visible
        }
      }
    }
  }

  // Mobile drawer footer â theme switcher row inside mobile nav
  .org-navbar__mobile-footer {
    @include flex(null, null, center, null, var(--semantic-space-inline-sm));
    @include padding(var(--semantic-space-component-sm) var(--semantic-space-component-md) var(--semantic-space-component-md));
    @include border(top, 1px, solid, var(--semantic-color-border-subtle));
    @include margin(var(--semantic-space-component-xs) null null null);

    &__label {
      font-size: var(--semantic-font-size-body-small);
      color: var(--semantic-color-text-tertiary);
      font-weight: var(--semantic-font-weight-medium, 500);
      white-space: nowrap;
    }
  }

  // -----------------------------------------------
  // SYX THEME SWITCHER
  // Dot-pills strip — needs to live inside the mixin
  // so it emits after the @layer order declaration.
  // -----------------------------------------------
  .syx-theme-switcher {
    @include flex(null, center, center, null, 6px);
    @include padding(4px 8px);
    background: rgba(0, 0, 0, 0.06);
    @include border-radius(999px);

    &__btn {
      @include size(16px);
      @include border-radius(50%);
      @include border(all, 2px, solid, transparent);
      cursor: pointer;
      @include padding(0);
      @include transition(transform 0.15s ease, box-shadow 0.15s ease);
      outline: none;

      &[data-theme="example-01"] { background: #7c3aed; }
      &[data-theme="example-02"] { background: #2563eb; }
      &[data-theme="example-03"] { background: #e11d48; }
      &[data-theme="example-04"] { background: #16a34a; }
      &[data-theme="example-05"] { background: #0f172a; }

      @media (hover: hover) {
        &:hover { transform: scale(1.25); }
      }

      &:focus-visible {
        box-shadow: 0 0 0 2px #fff, 0 0 0 4px rgba(0, 0, 0, 0.4);
      }

      &--active {
        border-color: rgba(0, 0, 0, 0.3);
        transform: scale(1.2);
        box-shadow: 0 0 0 2px #fff, 0 0 0 3px rgba(0, 0, 0, 0.2);
      }
    }
  }

  } // end @layer syx.organisms
} // end @mixin org-navbar

  // -----------------------------------------------
  // Note: .syx-theme-switcher styles are included above
  // inside @mixin org-navbar → @layer syx.organisms
  // -----------------------------------------------
